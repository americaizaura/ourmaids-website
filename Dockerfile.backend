FROM node:16-alpine

ARG NODE_ENV=production
ENV NODE_ENV=${NODE_ENV}

RUN apk add --no-cache libc6-compat

# add turborepo
RUN yarn global add turbo

WORKDIR /app

#add strapi
RUN yarn global add @strapi/strapi@4.11.5

VOLUME [ "/app/apps/backend/public/uploads"]

# Copy source files
COPY . .

RUN yarn install
RUN yarn build --scope backend

CMD ["yarn", "dev", "--scope", "backend", "--include-dependencies", "--no-deps"]